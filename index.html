<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalDAV Event Sync - Calendar Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .stats h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }
        
        .event-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .event-category {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .event-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }
        
        .event-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .event-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: #555;
            font-size: 0.95rem;
        }
        
        .event-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .icon {
            width: 20px;
            height: 20px;
        }
        
        .sync-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .button-group-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        .sync-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.875rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .sync-button:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .sync-button.google {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
        }
        
        .sync-button.apple {
            background: linear-gradient(135deg, #555 0%, #000 100%);
        }
        
        .sync-button.outlook {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
        }
        
        .sync-button.download {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .sync-button.smart {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            font-size: 1rem;
            padding: 1rem;
        }
        
        .loading {
            text-align: center;
            color: white;
            font-size: 1.5rem;
            padding: 3rem;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .events-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÖ CalDAV Event Sync</h1>
            <p>Add events to your calendar with one click - No login required!</p>
        </div>
        
        <div class="stats">
            <h3 id="stats">Loading events...</h3>
            <p>Click any button to add events to Google, Apple, or Outlook Calendar</p>
        </div>
        
        <div id="events" class="events-grid">
            <div class="loading">Loading events...</div>
        </div>
    </div>
    
    <!-- Calendar Selection Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-header">Choose Your Calendar</div>
            <div class="modal-options" id="modalOptions">
                <!-- Options will be inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        // Events data - Edit this array to add/modify events
        const events = [
            {
                id: '1',
                uid: 'event-1@caldav-static.com',
                title: 'Sample Webinar: Getting Started',
                description: 'Learn the basics of our platform in this introductory webinar',
                location: 'Online - Zoom',
                startDate: new Date('2025-12-01T14:00:00Z'),
                endDate: new Date('2025-12-01T15:00:00Z'),
                isAllDay: false,
                category: 'Webinar'
            },
            {
                id: '2',
                uid: 'event-2@caldav-static.com',
                title: 'Product Launch Event',
                description: 'Join us for the launch of our new features',
                location: 'Virtual Event Hall',
                startDate: new Date('2025-12-05T10:00:00Z'),
                endDate: new Date('2025-12-05T11:30:00Z'),
                isAllDay: false,
                category: 'Launch'
            },
            {
                id: '3',
                uid: 'event-3@caldav-static.com',
                title: 'Annual Conference 2025',
                description: 'Our biggest event of the year with keynotes and networking',
                location: 'Convention Center',
                startDate: new Date('2025-12-15T09:00:00Z'),
                endDate: new Date('2025-12-15T18:00:00Z'),
                isAllDay: true,
                category: 'Conference'
            }
        ];
        
        // Generate ICS file content
        function generateICS(event) {
            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };
            
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//CalDAV Static//Event Calendar//EN',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'BEGIN:VEVENT',
                `UID:${event.uid}`,
                `DTSTAMP:${formatDate(new Date())}`,
                `DTSTART:${formatDate(event.startDate)}`,
                `DTEND:${formatDate(event.endDate)}`,
                `SUMMARY:${event.title}`,
                `DESCRIPTION:${event.description || ''}`,
                `LOCATION:${event.location || ''}`,
                'STATUS:CONFIRMED',
                'SEQUENCE:0',
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');
            
            return icsContent;
        }
        
        // Generate Google Calendar URL
        function getGoogleCalendarUrl(event) {
            const formatGoogleDate = (date, isAllDay) => {
                if (isAllDay) {
                    return date.toISOString().split('T')[0].replace(/-/g, '');
                }
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };
            
            const startDate = formatGoogleDate(event.startDate, event.isAllDay);
            const endDate = formatGoogleDate(event.endDate, event.isAllDay);
            
            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: event.title,
                dates: `${startDate}/${endDate}`,
                details: event.description || '',
                location: event.location || '',
                ctz: 'UTC'
            });
            
            return `https://calendar.google.com/calendar/render?${params.toString()}`;
        }
        
        // Generate Outlook Calendar URL
        function getOutlookCalendarUrl(event) {
            const params = new URLSearchParams({
                path: '/calendar/action/compose',
                rru: 'addevent',
                subject: event.title,
                startdt: event.startDate.toISOString(),
                enddt: event.endDate.toISOString(),
                body: event.description || '',
                location: event.location || '',
                allday: event.isAllDay ? 'true' : 'false'
            });
            
            return `https://outlook.live.com/calendar/0/deeplink/compose?${params.toString()}`;
        }
        
        // Download ICS file
        function downloadICS(event) {
            const icsContent = generateICS(event);
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${event.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}.ics`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Add to Google Calendar
        function addToGoogle(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                window.open(getGoogleCalendarUrl(event), '_blank');
            }
        }
        
        // Add to Apple Calendar (using data URI)
        function addToApple(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                const icsContent = generateICS(event);
                const dataUri = 'data:text/calendar;charset=utf-8,' + encodeURIComponent(icsContent);
                window.location.href = dataUri;
            }
        }
        
        // Add to Outlook Calendar
        function addToOutlook(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                window.open(getOutlookCalendarUrl(event), '_blank');
            }
        }
        
        // Download ICS file
        function downloadEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                downloadICS(event);
            }
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }
        
        // Format time for display
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true
            });
        }
        
        // Display events
        function displayEvents() {
            const container = document.getElementById('events');
            
            if (events.length === 0) {
                container.innerHTML = '<div class="loading">No events available</div>';
                return;
            }
            
            container.innerHTML = events.map(event => `
                <div class="event-card">
                    <span class="event-category">${event.category}</span>
                    <h2 class="event-title">${event.title}</h2>
                    <p class="event-description">${event.description}</p>
                    <div class="event-details">
                        <div class="event-detail">
                            <span class="icon">üìÖ</span>
                            <span>${formatDate(event.startDate)}</span>
                        </div>
                        <div class="event-detail">
                            <span class="icon">üïê</span>
                            <span>${formatTime(event.startDate)} - ${formatTime(event.endDate)}</span>
                        </div>
                        <div class="event-detail">
                            <span class="icon">üìç</span>
                            <span>${event.location}</span>
                        </div>
                    </div>
                    <div class="sync-buttons">
                        <button class="sync-button smart" onclick="smartAddToCalendar('${event.id}')">
                            <span>üìÖ Add to Calendar</span>
                        </button>
                        <div class="button-group-label" style="margin-top: 0.5rem;">Or choose manually:</div>
                        <button class="sync-button google" onclick="addToGoogle('${event.id}')">
                            <span>üìÖ Google Calendar</span>
                        </button>
                        <button class="sync-button apple" onclick="addToApple('${event.id}')">
                            <span>üçé Apple Calendar</span>
                        </button>
                        <button class="sync-button outlook" onclick="addToOutlook('${event.id}')">
                            <span>üìß Outlook Calendar</span>
                        </button>
                        <button class="sync-button download" onclick="downloadEvent('${event.id}')">
                            <span>‚¨á Download ICS File</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('stats').innerHTML = `üìä ${events.length} Events Available`;
        }
        
        // Detect user's device/OS
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const platform = navigator.platform.toLowerCase();
            
            // iOS devices
            if (/iphone|ipad|ipod/.test(userAgent)) {
                return 'ios';
            }
            
            // macOS
            if (/mac/.test(platform) && !/(iphone|ipad|ipod)/.test(userAgent)) {
                return 'macos';
            }
            
            // Android
            if (/android/.test(userAgent)) {
                return 'android';
            }
            
            // Windows
            if (/win/.test(platform)) {
                return 'windows';
            }
            
            // Linux
            if (/linux/.test(platform)) {
                return 'linux';
            }
            
            return 'unknown';
        }
        
        // Smart add to calendar - detects device and redirects or shows options
        function smartAddToCalendar(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const device = detectDevice();
            
            // Auto-redirect based on device
            switch(device) {
                case 'ios':
                    // iOS - show modal with Apple Calendar and Google Calendar
                    showCalendarModal(eventId, ['apple', 'google', 'outlook']);
                    break;
                    
                case 'macos':
                    // macOS - show modal with Apple Calendar and Google Calendar
                    showCalendarModal(eventId, ['apple', 'google', 'outlook']);
                    break;
                    
                case 'android':
                    // Android - redirect to Google Calendar
                    addToGoogle(eventId);
                    break;
                    
                case 'windows':
                    // Windows - show modal with Outlook and Google Calendar
                    showCalendarModal(eventId, ['outlook', 'google', 'apple']);
                    break;
                    
                default:
                    // Unknown - show all options
                    showCalendarModal(eventId, ['google', 'outlook', 'apple', 'download']);
            }
        }
        
        // Show calendar selection modal
        function showCalendarModal(eventId, options) {
            const modal = document.getElementById('calendarModal');
            const modalOptions = document.getElementById('modalOptions');
            
            const optionButtons = {
                'google': {
                    label: 'üìÖ Google Calendar',
                    class: 'google',
                    action: () => addToGoogle(eventId)
                },
                'apple': {
                    label: 'üçé Apple Calendar',
                    class: 'apple',
                    action: () => addToApple(eventId)
                },
                'outlook': {
                    label: 'üìß Outlook Calendar',
                    class: 'outlook',
                    action: () => addToOutlook(eventId)
                },
                'download': {
                    label: '‚¨á Download ICS File',
                    class: 'download',
                    action: () => downloadEvent(eventId)
                }
            };
            
            modalOptions.innerHTML = options.map(option => `
                <button class="sync-button ${optionButtons[option].class}" 
                        onclick="handleModalOption('${option}', '${eventId}')">
                    <span>${optionButtons[option].label}</span>
                </button>
            `).join('');
            
            modal.classList.add('show');
        }
        
        // Handle modal option selection
        function handleModalOption(option, eventId) {
            closeModal();
            
            switch(option) {
                case 'google':
                    addToGoogle(eventId);
                    break;
                case 'apple':
                    addToApple(eventId);
                    break;
                case 'outlook':
                    addToOutlook(eventId);
                    break;
                case 'download':
                    downloadEvent(eventId);
                    break;
            }
        }
        
        // Close modal
        function closeModal() {
            const modal = document.getElementById('calendarModal');
            modal.classList.remove('show');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('calendarModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            displayEvents();
            updateStats();
            
            // Log detected device for debugging
            console.log('Detected device:', detectDevice());
        });
    </script>
</body>
</html>

